<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOFF Sample</title>

    <!-- WOFF SDKの追加 -->
    <script charset="utf-8" src="https://static.worksmobile.net/static/wm/woff/edge/3.6/sdk.js"></script>

    <script>
        var woffid = "aqbfr51mLmVaMKkHxhqkAg"; // 変数woffidの指定

        var currentLocation = null; // 現在の位置情報を保存する変数

        function scanQRCode() {
            woff.scanQR().then((result) => {
                document.getElementById("scanResult").innerText = result.value;
            }).catch((err) => {
                console.log("Error scanning QR:", err);
            });
        }

        function getLocation() {
            navigator.geolocation.getCurrentPosition((position) => {
                currentLocation = position;
                document.getElementById("latitude").innerText = position.coords.latitude;
                document.getElementById("longitude").innerText = position.coords.longitude;
            }, (err) => {
                console.log("Error getting location:", err);
            });
        }

        function sendLocation() {
            if (currentLocation) {
                const locationMessage = `Latitude: ${currentLocation.coords.latitude}, Longitude: ${currentLocation.coords.longitude}`;
                woff.sendMessage({
                    content: locationMessage
                }).then(() => {
                    console.log('message sent');
                }).catch((err) => {
                    console.log('error', err);
                });
            } else {
                alert("Please get the location first!");
            }
        }

        window.onload = function() {
            function successCallback() {
                console.log("Initialization successful.");

                // woff.getProfileの実行
                woff.getProfile().then((profile) => {
                    document.getElementById("domainId").innerText = profile.domainId;
                    document.getElementById("userId").innerText = profile.userId;
                    document.getElementById("displayName").innerText = profile.displayName;
                }).catch((err) => {
                    console.log("Error fetching profile:", err);
                });
            }

            function errorCallback(err) {
                console.log("Initialization failed:", err);
            }

            // woff.initの実行
            woff.init(
                { woffId: woffid }, 
                successCallback, 
                errorCallback
            );
        }
    </script>
</head>
<body>
    <header>
        WOFF Sample
    </header>

    <!-- プロフィール情報を表示する領域 -->
    <div>
        <h3>Profile Information:</h3>
        <p>Domain ID: <span id="domainId"></span></p>
        <p>User ID: <span id="userId"></span></p>
        <p>Display Name: <span id="displayName"></span></p>
    </div>

    <!-- QRコードスキャンボタンと結果の表示領域 -->
    <div>
        <button onclick="scanQRCode()">Start QR Code Scanner</button>
        <h3>Scan Result:</h3>
        <p id="scanResult"></p>
    </div>

    <!-- 位置情報を取得するボタンと結果の表示領域 -->
    <div>
        <button onclick="getLocation()">Get Location</button>
        <button onclick="sendLocation()">Send Location</button>
        <h3>Location Result:</h3>
        <p>Latitude: <span id="latitude"></span></p>
        <p>Longitude: <span id="longitude"></span></p>
    </div>

    <!-- ... (その他のコンテンツ) ... -->
</body>
</html>
